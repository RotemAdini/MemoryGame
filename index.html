<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××©×—×§ ×”×–×™×›×¨×•×Ÿ ×”×’×“×•×œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #0a0a23 0%, #1a1a3a 30%, #2d1b69 60%, #8b2b9b 100%);
            min-height: 100vh;
            color: white;
            text-align: center;
            overflow-x: hidden;
            position: relative;
        }

        /* ×× ×™××¦×™×™×ª ×¨×§×¢ */
        .synthwave-grid {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) perspective(500px) rotateX(60deg);
            width: 200%;
            height: 50vh;
            background-image: 
                linear-gradient(rgba(255, 0, 150, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 0, 150, 0.3) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: gridMove 10s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes gridMove {
            0% { transform: translateX(-50%) perspective(500px) rotateX(60deg) translateZ(0); }
            100% { transform: translateX(-50%) perspective(500px) rotateX(60deg) translateZ(40px); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes confetti {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .screen {
            display: none;
            width: 100%;
            animation: fadeInUp 0.8s ease-out;
        }

        .screen.active {
            display: block;
        }

        .title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 2rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 3s infinite;
        }

        .subtitle {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .card {
            background: rgba(26, 0, 51, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 2.5rem;
            margin: 1.5rem 0;
            border: 2px solid #ff0084;
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(255, 0, 132, 0.3),
                inset 0 0 30px rgba(0, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .btn {
            background: linear-gradient(45deg, #ff0084, #00ffff);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin: 15px auto;
            transition: all 0.4s ease;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 0, 132, 0.5);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            display: block;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(255, 0, 132, 0.8);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        .btn-success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }

        .btn-share {
            background: linear-gradient(45deg, #25D366, #128C7E);
        }

        .input-group {
            margin: 1.5rem 0;
            text-align: center;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .input-group input, .input-group select {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            border-radius: 20px;
            border: none;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            transition: all 0.3s ease;
            margin: 0 auto;
            display: block;
        }

        .players-info {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .player-card {
            flex: 1;
            min-width: 200px;
            margin: 0.5rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            text-align: center;
        }

        .failures {
            color: #ff6b6b;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .question-card {
            background: rgba(26, 0, 51, 0.4);
            border-radius: 30px;
            padding: 4rem 3rem;
            margin: 3rem 0;
            font-size: 1.8rem;
            line-height: 1.8;
            border: 3px solid #00ffff;
            box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(0, 255, 255, 0.4),
                inset 0 0 40px rgba(255, 0, 132, 0.1);
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
        }

        .chapter-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 3rem 0;
            text-align: center;
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s infinite;
        }

        .timer {
            font-size: 10rem;
            font-weight: bold;
            margin: 3rem 0;
            text-shadow: 5px 5px 10px rgba(0,0,0,0.7);
            animation: pulse 1s infinite;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 3rem auto;
            max-width: 600px;
            width: 100%;
        }

        .controls .btn {
            width: 100%;
            padding: 20px;
            font-size: 1.1rem;
            margin: 0;
            display: inline-block;
        }

        .secondary-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 2rem auto;
            max-width: 600px;
        }

        .secondary-controls .btn {
            display: inline-block;
            margin: 0;
            font-size: 0.9rem;
            padding: 12px 20px;
        }

        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 3rem;
            border-radius: 30px;
            text-align: center;
            max-width: 600px;
            margin: 20px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            border: 3px solid rgba(255, 255, 255, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .popup-content .btn {
            display: inline-block;
            margin: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border-radius: 6px;
            transition: width 0.8s ease;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 70px;
            height: 40px;
            margin: 0 15px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 40px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 32px;
            width: 32px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .score-animation {
            font-size: 4rem;
            font-weight: bold;
            color: #4ecdc4;
            transition: all 1s ease;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .celebration {
            animation: pulse 0.5s infinite alternate;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .sensual-warning {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1rem 0;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .settings-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff0084;
            animation: confetti 3s linear;
            z-index: 1001;
        }

        .confetti:nth-child(even) {
            background: #00ffff;
            animation-delay: 0.5s;
        }

        .confetti:nth-child(3n) {
            background: #ffeaa7;
            animation-delay: 0.3s;
        }

        @media (max-width: 768px) {
            body {
                height: 100vh;
                overflow: hidden;
            }
            
            .container {
                padding: 5px;
                height: 100vh;
                max-height: 100vh;
                overflow-y: auto;
                overflow-x: hidden;
            }
            
            .screen {
                min-height: calc(100vh - 10px);
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            
            #game-screen {
                justify-content: flex-start;
                padding-top: 70px;
            }
            
            .title { 
                font-size: 1.8rem;
                margin-bottom: 1rem;
            }
            
            .subtitle { 
                font-size: 1rem;
                margin-bottom: 1rem;
            }
            
            .players-info { 
                flex-direction: row;
                margin: 0.5rem 0;
                gap: 5px;
            }
            
            .player-card {
                margin: 0;
                padding: 0.5rem;
                min-width: auto;
                font-size: 0.9rem;
            }
            
            .player-card:nth-child(2) {
                flex: 2;
            }
            
            .controls { 
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                margin: 1rem 0;
            }
            
            .controls .btn {
                width: 100%;
                padding: 12px 5px;
                font-size: 0.85rem;
                margin: 0;
            }
            
            .secondary-controls {
                gap: 8px;
                margin: 0.5rem 0;
            }
            
            .secondary-controls .btn {
                font-size: 0.8rem;
                padding: 10px 15px;
                margin: 0;
            }
            
            .btn { 
                width: 90%;
                max-width: 350px;
                font-size: 1rem;
                padding: 12px 20px;
                margin: 10px auto;
            }
            
            .question-card { 
                font-size: 1rem;
                padding: 1.5rem 1rem;
                margin: 1rem 0;
                min-height: 120px;
            }
            
            .timer { 
                font-size: 4rem;
                margin: 2rem 0;
            }
            
            .card {
                padding: 1rem;
                margin: 0.5rem 0;
            }
            
            .popup-content {
                padding: 1.5rem;
                margin: 10px;
            }
            
            .popup-content .btn {
                font-size: 0.9rem;
                padding: 10px 15px;
                margin: 5px;
            }
            
            .chapter-title {
                font-size: 1.5rem;
                margin: 1.5rem 0;
            }
            
            .settings-btn {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            /* ×”×¡×ª×¨×ª ×”×× ×™××¦×™×•×ª ×‘×¨×§×¢ ×‘××•×‘×™×™×œ ×œ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™× */
            .synthwave-grid {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="synthwave-grid"></div>
    
    <button class="settings-btn" onclick="openSettings()" title="×”×’×“×¨×•×ª">âš™ï¸</button>

    <div class="container">
        <!-- ××¡×š ×‘×¨×•×›×™× ×”×‘××™× -->
        <div id="welcome-screen" class="screen active">
            <div class="title">ğŸ® ××©×—×§ ×”×–×™×›×¨×•×Ÿ ×”×’×“×•×œ ğŸ®</div>
            <div class="subtitle">×”××©×—×§ ×”×–×•×’×™ ×©×™×‘×“×§ ×›××” ×˜×•×‘ ××ª× ××›×™×¨×™× ××—×“ ××ª ×”×©× ×™!</div>
            <div class="card">
                <p>×‘×¨×•×›×™× ×”×‘××™× ×œ××©×—×§ ×”×›×™ ××”× ×” ×œ×–×•×’×•×ª! ğŸ’•</p>
                <p>40 ×©××œ×•×ª ×–×™×›×¨×•×Ÿ ××™×•×—×“×•×ª ×©×™×¢×•×¨×¨×• ×–×™×›×¨×•× ×•×ª ××ª×•×§×™× ×•×™×¦×—×§×• ××ª×›×</p>
            </div>
            <button class="btn" onclick="nextScreen()">â¡ï¸ ×‘×•××• × ×ª×—×™×œ!</button>
        </div>

        <!-- ××¡×š ×”×’×“×¨×ª ×©×—×§× ×™× -->
        <div id="players-screen" class="screen">
            <div class="title">ğŸ‘« ×¤×¨×˜×™ ×”×©×—×§× ×™×</div>
            <div class="card">
                <div class="input-group">
                    <label>×©× ×”×©×—×§×Ÿ ×”×¨××©×•×Ÿ:</label>
                    <input type="text" id="player1-name" placeholder="×”×›× ×¡ ×©×">
                </div>
                <div class="input-group">
                    <label>××’×“×¨:</label>
                    <select id="player1-gender">
                        <option value="male">×–×›×¨</option>
                        <option value="female">× ×§×‘×”</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>×©× ×”×©×—×§×Ÿ ×”×©× ×™:</label>
                    <input type="text" id="player2-name" placeholder="×”×›× ×¡ ×©×">
                </div>
                <div class="input-group">
                    <label>××’×“×¨:</label>
                    <select id="player2-gender">
                        <option value="male">×–×›×¨</option>
                        <option value="female">× ×§×‘×”</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="nextScreen()">â¡ï¸ ×”××©×š</button>
        </div>

        <!-- ××¡×š ×¤×¨×¡ -->
        <div id="prize-screen" class="screen">
            <div class="title">ğŸ† ×¢×œ ××” ××ª× ××ª×—×¨×™×?</div>
            <div class="card">
                <div class="input-group">
                    <label>××” ×”×¤×¨×¡ ×œ×× ×¦×—?</label>
                    <input type="text" id="prize" placeholder="×œ×“×•×’××”: ××¡××–' ×©×œ 30 ×“×§×•×ª...">
                </div>
            </div>
            <button class="btn" onclick="nextScreen()">â¡ï¸ ×”××©×š</button>
        </div>

        <!-- ××¡×š ×”×¡×‘×¨ -->
        <div id="rules-screen" class="screen">
            <div class="title">ğŸ“‹ ××™×š ×”××©×—×§ ×¢×•×‘×“?</div>
            <div class="card">
                <ul style="text-align: center; line-height: 2.2; list-style: none; font-size: 1.1rem;">
                    <li>ğŸ¯ ×”××©×—×§ ××•×¨×›×‘ ×-6 ×—×œ×§×™× ×©×•× ×™× ×¢× 40 ×©××œ×•×ª</li>
                    <li>ğŸ—£ï¸ ××ª× ×¢×•× ×™× ×¢×œ ×”×©××œ×•×ª ×‘×§×•×œ ×•××—×œ×™×˜×™× ××™ ×–×›×¨ × ×›×•×Ÿ</li>
                    <li>âœ… ×œ×•×—×¦×™× ×¢×œ ×”×›×¤×ª×•×¨ ×©×œ ××™ ×©×”×¦×œ×™×— ×œ×¢× ×•×ª</li>
                    <li>ğŸ’¥ ×›×œ 5 ×¤×¡×™×œ×•×ª = ××©×™××” ××™×•×—×“×ª (×× ×‘×—×¨×ª× ×œ×›×œ×•×œ)</li>
                    <li>âš ï¸ 3 ×¤×¡×™×œ×•×ª ×¨×¦×•×¤×•×ª = ×”×•×“×¢×ª ×¢×™×“×•×“/×¢×§×™×¦×”</li>
                    <li>ğŸ† ×‘×¡×•×£ × ×’×œ×” ××™ ×”×× ×¦×— ×•××” ×”×¤×¨×¡!</li>
                </ul>
                
                <div class="info-box">
                    <div class="input-group">
                        <label style="font-size: 1.3rem; margin-bottom: 1rem;">×”×× ×œ×›×œ×•×œ ××©×™××•×ª ×—×•×©× ×™×•×ª ×‘××©×—×§?</label>
                        <div style="display: flex; align-items: center; justify-content: center; margin: 1.5rem 0;">
                            <span style="font-size: 1.1rem;">×œ×</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="sensual-tasks" checked>
                                <span class="slider"></span>
                            </label>
                            <span style="font-size: 1.1rem;">×›×Ÿ</span>
                        </div>
                        <div id="sensual-warning" class="sensual-warning">
                            âš ï¸ ×‘×—×™×¨×” ×‘"×›×Ÿ" ×ª×•×¡×™×£ ××©×™××•×ª ××™× ×˜×™××™×•×ª ×œ××©×—×§
                        </div>
                    </div>
                </div>
            </div>
            <button class="btn" onclick="startCountdown()">ğŸ® ××•×›× ×™×? ×‘×•××• × ×ª×—×™×œ!</button>
        </div>

        <!-- ××¡×š ×¡×¤×™×¨×” ×œ××—×•×¨ -->
        <div id="countdown-screen" class="screen">
            <div class="timer" id="countdown-timer">3</div>
        </div>

        <!-- ××¡×š ×›×•×ª×¨×ª ×—×œ×§ -->
        <div id="chapter-screen" class="screen">
            <div class="chapter-title" id="chapter-title"></div>
            <button class="btn" onclick="startQuestions()">â¡ï¸ ×‘×•××• × ×ª×—×™×œ ××ª ×”×—×œ×§!</button>
        </div>

        <!-- ××¡×š ××©×—×§ -->
        <div id="game-screen" class="screen">
            <div class="players-info">
                <div class="player-card">
                    <div id="player1-display">×©×—×§×Ÿ 1</div>
                    <div class="failures">âŒ <span id="player1-failures">0</span></div>
                </div>
                <div class="player-card">
                    <div>×©××œ×” <span id="current-question">1</span>/40</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 2.5%"></div>
                    </div>
                </div>
                <div class="player-card">
                    <div id="player2-display">×©×—×§×Ÿ 2</div>
                    <div class="failures">âŒ <span id="player2-failures">0</span></div>
                </div>
            </div>

            <div class="question-card" id="question-display">
                ×©××œ×” ×ª×•×¤×™×¢ ×›××Ÿ
            </div>

            <div class="controls">
                <button class="btn btn-success" onclick="answerQuestion(1)">
                    ğŸ† <span id="player1-btn">×©×—×§×Ÿ 1 × ×™×¦×—</span>
                </button>
                <button class="btn btn-success" onclick="answerQuestion(2)">
                    ğŸ† <span id="player2-btn">×©×—×§×Ÿ 2 × ×™×¦×—</span>
                </button>
                <button class="btn btn-secondary" onclick="answerQuestion('both')">
                    âœ… ×©× ×™× ×• ×”×¦×œ×—× ×•
                </button>
                <button class="btn btn-danger" onclick="answerQuestion('none')">
                    âŒ ×©× ×™× ×• ×œ× ×–×›×¨× ×•
                </button>
            </div>

            <div class="secondary-controls">
                <button class="btn btn-warning" onclick="undoLastAction()">ğŸ” ×‘×˜×œ ×¤×¢×•×œ×”</button>
            </div>
        </div>

        <!-- ××¡×š ×ª×•×¦××•×ª -->
        <div id="results-screen" class="screen">
            <div class="title">ğŸ† ×ª×•×¦××•×ª ×”××©×—×§!</div>
            <div class="card">
                <div id="final-results"></div>
            </div>
            <button class="btn btn-share" onclick="shareResults()">ğŸ“± ×©×ª×£ ×‘×•×•×˜×¡××¤</button>
            <button class="btn" onclick="restartGame()">ğŸ”„ ××©×—×§ ×—×“×©</button>
        </div>
    </div>

    <!-- ×¤×•×¤××¤×™× -->
    
    <!-- ×¤×•×¤××¤ ×”×’×“×¨×•×ª -->
    <div id="settings-popup" class="popup">
        <div class="popup-content">
            <div class="title">âš™ï¸ ×”×’×“×¨×•×ª</div>
            <div class="input-group">
                <label>×©× ×©×—×§×Ÿ 1:</label>
                <input type="text" id="settings-player1-name">
            </div>
            <div class="input-group">
                <label>×©× ×©×—×§×Ÿ 2:</label>
                <input type="text" id="settings-player2-name">
            </div>
            <div class="input-group">
                <label>×”×¤×¨×¡:</label>
                <input type="text" id="settings-prize">
            </div>
            <div style="margin: 2rem 0; padding: 1.5rem; background: rgba(255,255,255,0.1); border-radius: 15px;">
                <p style="margin-bottom: 1rem;">ğŸ’Œ ×™×¦×™×¨×ª ×§×©×¨:</p>
                <p>×œ××©×•×‘, ×”×¦×¢×•×ª ××• ×©××œ×•×ª:</p>
                <p style="direction: ltr;">contact@memorygame.com</p>
            </div>
            <button class="btn btn-success" onclick="saveSettings()">ğŸ’¾ ×©××•×¨ ×©×™× ×•×™×™×</button>
            <button class="btn btn-secondary" onclick="closeSettings()">âŒ ×¡×’×•×¨</button>
        </div>
    </div>

    <!-- ×¤×•×¤××¤ ×”×•×“×¢×” ×¢×œ 5 ×¤×¡×™×œ×•×ª -->
    <div id="failure-warning-popup" class="popup">
        <div class="popup-content">
            <div class="title" style="color: #ff6b6b;">ğŸ˜± ××•×™ ××•×™ ××•×™!</div>
            <div id="failure-warning-content" style="font-size: 1.4rem; margin: 2rem 0;"></div>
            <button class="btn btn-danger" onclick="showSensualTask()">ğŸ˜ˆ ×›×Ÿ, ×× ×™ ××•×›×Ÿ/×” ×œ××©×™××”!</button>
            <button class="btn btn-secondary" onclick="skipTask()">ğŸ˜… ××•×œ×™ ×¤×¢× ×”×‘××”...</button>
        </div>
    </div>

    <!-- ×¤×•×¤××¤ ×œ××©×™××” ×—×•×©× ×™×ª -->
    <div id="task-popup" class="popup">
        <div class="popup-content">
            <div class="title">ğŸ’• ×”××©×™××” ×©×œ×š!</div>
            <div id="task-content" style="font-size: 1.3rem; margin: 2rem 0;"></div>
            <button class="btn btn-success" onclick="completeTask()">âœ… ×‘×™×¦×¢×ª×™ ××ª ×”××©×™××”</button>
        </div>
    </div>

    <!-- ×¤×•×¤××¤ ×œ×”×•×“×¢×” ×¢×œ 3 ×¤×¡×™×œ×•×ª ×¨×¦×•×¤×•×ª -->
    <div id="message-popup" class="popup">
        <div class="popup-content">
            <div id="message-content"></div>
            <button class="btn" onclick="closeMessagePopup()">âœ… ×”×‘× ×ª×™</button>
        </div>
    </div>

    <script>
        let gameState = {
            currentScreen: 0,
            currentQuestion: 0,
            currentChapter: 0,
            player1: { name: '', gender: 'male', score: 0, failures: 0, consecutiveFailures: 0 },
            player2: { name: '', gender: 'male', score: 0, failures: 0, consecutiveFailures: 0 },
            prize: '',
            sensualTasks: true,
            currentTaskIndex: 0,
            lastAction: null,
            currentTaskPlayer: null,
            hasUsedUndo: false
        };

        const chapters = [
            {
                title: "ğŸŒŸ ×—×œ×§ 1: ×–×™×›×¨×•× ×•×ª ×§×œ××¡×™×™×",
                questions: [
                    "××™×¤×” ×”×™×” ×”×“×™×™×˜ ×”×¨××©×•×Ÿ ×©×œ×›×?",
                    "××” ×”×™×™×ª×” ×”×”×–×× ×” ×”××—×¨×•× ×” ×©×”×–×× ×ª× ×‘×˜×™×™×§××•×•×™?",
                    "×‘××™×–×” ×¡×¨×˜ ×¦×¤×™×ª× ×™×—×“ ×‘×¤×¢× ×”××—×¨×•× ×”?",
                    "×‘××™×–×” ×™×•× ×‘×©×‘×•×¢ ×”×™×” ×”×“×™×™×˜ ×”×¨××©×•×Ÿ ×©×œ×›×?",
                    "××™×¤×” ×©×ª×™×ª× ×§×¤×” ×–×•×’×™ ×œ××—×¨×•× ×” ××—×•×¥ ×œ×‘×™×ª?",
                    "××™×¤×” ×—×’×’×ª× ×œ×¨××©×•× ×” ××©×”×• ×–×•×’×™ (×›××• ×—×•×“×©, ×—×¦×™ ×©× ×” ××• ×™×•× ×”×•×œ×“×ª)?"
                ]
            },
            {
                title: "âš¡ ×—×œ×§ 2: ×”×¨×’×¢×™× ×©×œ ×¢×›×©×™×•",
                questions: [
                    "××™×¤×” ×”×™×” ×”×“×™×™×˜ ×”××—×¨×•×Ÿ ×©×œ×›× â€“ ×¨×§ ×©× ×™×›× ×©×œ× ×”×™×” ×‘××¡×¢×“×”?",
                    "××ª×™ ×‘×¤×¢× ×”××—×¨×•× ×” ×××¨×ª× \"×× ×™ ××•×”×‘/×ª ××•×ª×š\"?",
                    "××” ×”×™×™×ª×” ×”×”×•×“×¢×” ×”××—×¨×•× ×” ×©×©×œ×—×ª× ××—×“ ×œ×©× ×™?",
                    "××ª×™ ×‘×¤×¢× ×”××—×¨×•× ×” ×¢×©×™×ª× ×¤×¢×™×œ×•×ª ×¡×¤×•×¨×˜×™×‘×™×ª ×‘×™×—×“?",
                    "××” ×”×™×” ×”×¡×¨×˜ ×”××—×¨×•×Ÿ ×©×¨××™×ª× ×™×—×“ ×‘×§×•×œ× ×•×¢?",
                    "××ª×™ ×‘×¤×¢× ×”××—×¨×•× ×” ×”×œ×›×ª× ×™×—×“ ×œ×—× ×•×ª â€“ ×•××™×–×• ×—× ×•×ª ×–×• ×”×™×™×ª×”?",
                    "××ª×™ ×‘×¤×¢× ×”××—×¨×•× ×” × ×¡×¢×ª× ×™×—×“ ×‘××•× ×™×ª ××• ××•×˜×•×‘×•×¡ â€“ ×•×œ××Ÿ?",
                    "××™×¤×” ×”×™×™×ª× ×›×©×©× ×™×›× ×§××ª× ×××•×—×¨ ×‘××™×•×—×“?"
                ]
            },
            {
                title: "ğŸ‘¥ ×—×œ×§ 3: ××¤×’×©×™× ×—×‘×¨×ª×™×™×",
                questions: [
                    "××™×¤×” × ×¤×’×©×ª× ×œ×¨××©×•× ×” ×¢× ×”××©×¤×—×” ×©×œ PLAYER1?",
                    "××ª×™ ×¢×©×™×ª× ×¢×¨×‘ ×—×’ ×¨××©×•×Ÿ ××¦×œ ×”××©×¤×—×” ×©×œ PLAYER2?",
                    "××™×¤×” ×¤×’×©×ª× ×œ×¨××©×•× ×” ××ª ×”×—×‘×¨×™× ×”×›×™ ×§×¨×•×‘×™× ×©×œ PLAYER1?",
                    "××ª×™ ×”×™×™×ª×” ×”×¤×¢× ×”××—×¨×•× ×” ×©× ×¤×’×©×ª× ×¢× ×—×‘×¨×™× ××©×•×ª×¤×™× â€“ ×•××¦×œ ××™ ×–×” ×”×™×”?",
                    "××ª×™ ××™×¨×—×ª× (××• ×”×ª××¨×—×ª× ××¦×œ) ×× ×©×™× ×‘×¤×¢× ×”××—×¨×•× ×” â€“ ×•××™ ×”×™×”?",
                    "××” ×”×™×” ×”××™×¨×•×¢ ×”×—×‘×¨×ª×™ ×”××—×¨×•×Ÿ ×©×”×™×™×ª× ×‘×• ×™×—×“ â€“ ×•××™×¤×” ×–×” ×”×™×”?"
                ]
            },
            {
                title: "ğŸ”„ ×—×œ×§ 4: ××” ×§×¨×” ×‘×¤×¢× ×”××—×¨×•× ×” ×©...",
                questions: [
                    "××™×¤×” ×”×™×™×ª× ×‘×¤×¢× ×”××—×¨×•× ×” ×©×™×©× ×ª× ××—×•×¥ ×œ×‘×™×ª?",
                    "××” ×”×™×” ×”××§×•× ×”××—×¨×•×Ÿ ×©×‘×• ××›×œ×ª× ×™×—×“ ×‘×—×•×¥ (××¡×¢×“×”/×‘×™×ª ×§×¤×”)?",
                    "××” ×”×™×” ×”×¡×¨×˜ ×”××—×¨×•×Ÿ ×©×¨××™×ª× ×™×—×“ ×‘×‘×™×ª?",
                    "××” ×”×™×” ×”××©×œ×•×— ×”××—×¨×•×Ÿ ×©×§×™×‘×œ×ª× ×™×—×“ (××•×›×œ ××• ×—×‘×™×œ×”)?"
                ]
            },
            {
                title: "ğŸ’ ×—×œ×§ 5: ××™×¨×•×¢×™× ×–×•×’×™×™× ××™×•×—×“×™×",
                questions: [
                    "××™×¤×” ×—×’×’×ª× ×‘×¤×¢× ×”×¨××©×•× ×” ×™×•× ×”×•×œ×“×ª (×©×œ ××—×“ ××›×)?",
                    "××™×¤×” ×”×™×™×ª× ×‘×™×•× ×”××”×‘×” ×”×¨××©×•×Ÿ ×©×œ×›× (×•×œ× ×˜×™×™×Ÿ / ×˜\"×• ×‘××‘)?",
                    "××ª×™ ×‘×¤×¢× ×”××—×¨×•× ×” ×¢×©×™×ª× ×™×—×“ ×™×•× ×›×™×£ ×‘×‘×™×ª? (××¨×ª×•×Ÿ ×˜×œ×•×•×™×–×™×”, ××•×›×œ ×˜×•×‘ ×•×›×•')",
                    "××ª×™ ×”×™×™×ª×” ×”×¤×¢× ×”××—×¨×•× ×” ×©×§× ×™×ª× ××—×“ ×œ×©× ×™ ××ª× ×” ×©×œ× ×œ×™×•× ×”×•×œ×“×ª â€“ ×•××” ×”×™×™×ª×” ×”××ª× ×”?",
                    "××™×–×• ×”×•×“×¢×” ××©××—×ª ××• ×—×©×•×‘×” ×§×™×‘×œ ××—×“ ××›× ×œ××—×¨×•× ×” â€“ ×•××” ×¢×©×™×ª× ×‘××•×ª×• ×¨×’×¢?",
                    "××ª×™ ×•××™×¤×” ×”×™×™×ª× ×›×©×§×™×‘×œ×ª× ×™×—×“ ×”×—×œ×˜×” ×¢×œ ××©×”×• ××©××¢×•×ª×™ â€“ ×›××• ×œ×§× ×•×ª ××©×”×• ×’×“×•×œ, ×œ×©× ×•×ª ×›×™×•×•×Ÿ ××• ×œ×”×ª×—×™×œ ××©×”×• ×—×“×©?"
                ]
            },
            {
                title: "ğŸ­ ×—×œ×§ 6: ×××—×•×¨×™ ×”×§×œ×¢×™× ×©×œ ×”×–×•×’×™×•×ª",
                questions: [
                    "××™ ×”×ª×—×™×œ ×¢× ××™?",
                    "××™ ×‘×—×¨ ××ª ×”××§×•× ×©×‘×• ×”×™×” ×”×“×™×™×˜ ×”×¨××©×•×Ÿ ×©×œ×›×?",
                    "××ª×™ ×”×—×œ×˜×ª× ×¨×©××™×ª ×©××ª× ×–×•×’?",
                    "××™ ×™×–× ××ª ×”×¤×¢× ×”××—×¨×•× ×” ×©× ×¡×¢×ª× ×œ×—×•×¤×©×” ×™×—×“?",
                    "××™ ×–×” ×©×”×‘×™× ××ª ×”×¨×¢×™×•×Ÿ ×œ×‘×œ×•×ª ××ª ×”×¡×•×¤\"×© ×”××—×¨×•×Ÿ ×›××• ×©×”×•× ×”×™×”?",
                    "××™ ×‘×—×¨ ××ª ×”×¡×“×¨×” ×”××—×¨×•× ×” ×©×¨××™×ª× ×™×—×“?",
                    "××™ ×”×¦×™×¢ ×œ×¢×©×•×ª ××©×”×• ×¨×•×× ×˜×™ ×‘×¤×¢× ×”××—×¨×•× ×” â€“ ×•××” ×–×” ×”×™×”?",
                    "××™ ×–×” ×©×‘×—×¨ ××ª ×”××¡×¢×“×” ×”××—×¨×•× ×”?",
                    "××™ ×××¨ \"×× ×™ ××•×”×‘/×ª ××•×ª×š\" ×‘×¤×¢× ×”××—×¨×•× ×” â€“ ×•××ª×™ ×–×” ×”×™×”?",
                    "×¨×’×¢ ×©×œ ×©×™×ª×•×£ â€“ ××ª×™ ×”×™×™×ª×” ×”×¤×¢× ×”××—×¨×•× ×” ×©×”×¡×ª×›×œ×ª× ××—×“ ×¢×œ ×”×©× ×™ ×•×—×©×‘×ª× \"××™×–×” ××–×œ ×©×× ×—× ×• ×™×—×“\"? ×•××™×¤×” ×–×” ×”×™×”?"
                ]
            }
        ];

        const sensualTasks = [
            "PLAYER1, ×©×‘/×™ ×¢×œ ×”×‘×¨×›×™×™× ×©×œ PLAYER2 ×•×”×‘×™×˜×• ××—×“ ×œ×©× ×™ ×‘×¢×™× ×™×™× ×‘××©×š ×“×§×” â€“ ×‘×œ×™ ×œ×—×™×™×š.",
            "PLAYER1, ×ª×Ÿ/×™ ×œPLAYER2 × ×©×™×§×” ××¨×•×›×” ×©×œ ×“×§×” â€“ ×‘×œ×™ ×œ×”×¤×¡×™×§.",
            "PLAYER1, ×”×•×¨×“/×™ ××ª ×”×—×•×œ×¦×” ×©×œ×š.",
            "PLAYER1, ×œ×—×©/×™ ××©×¤×˜ ××™× ×™ ×‘××•×–×Ÿ ×©×œ PLAYER2.",
            "PLAYER1, ×œ×§×§/×™ ×‘×¢×“×™× ×•×ª ××ª ×”×©×¤×ª×™×™× ×©×œ PLAYER2 â€“ ×œ××©×š 10 ×©× ×™×•×ª.",
            "PLAYER1, × ×©×§/×™ ××ª PLAYER2 ×‘×©×œ×•×©×” ××§×•××•×ª ××™× ×˜×™××™×™× ×‘×’×•×£.",
            "PLAYER1, ×”×•×¨×“/×™ ××ª ×”××›× ×¡ ×©×œ×š ××• ×©×œ PLAYER2.",
            "PLAYER1, ×ª××¨/×™ ×‘×§×¦×¨×” ×¤× ×˜×–×™×” ××™× ×™×ª ×©×™×© ×œ×š.",
            "×©× ×™×›× - ×”×“×’×™××• ×ª× ×•×—×” ××”×•×‘×” (×‘×œ×‘×•×© ×‘×œ×‘×“) â€“ ×‘×œ×™ ××™×œ×™×.",
            "PLAYER1, ×”×¢×‘×¨/×™ ××ª ×”×œ×©×•×Ÿ ×œ××•×¨×š ××–×•×¨ ×‘×’×•×£ ×©×œ PLAYER2 â€“ ×œ×¤×™ ×‘×—×™×¨×ª×•/×”."
        ];

        const encouragementMessages = [
            { type: 'tease', message: 'PLAYER, ××ª/×” ×××© ××ª×§×©×” ×œ×”×™×–×›×¨! OTHER_PLAYER, ×ª×ª×›×•× ×Ÿ/×™ ×œ× ×™×¦×—×•×Ÿ!' },
            { type: 'encourage', message: 'PLAYER, ××œ ×ª×ª×™×™××©/×™ - ×¢×•×“ ×¨×’×¢ ××ª/×” ×—×•×–×¨/×ª ×œ×¢×¦××š!' },
            { type: 'compliment', message: 'OTHER_PLAYER, ××ª/×” ××“×”×™×/×”! ×©×œ×•×© ×”×¦×œ×—×•×ª ×¨×¦×•×¤×•×ª ×–×” ×œ× ××•×‘×Ÿ ×××œ×™×•.' },
            { type: 'funny', message: 'PLAYER, × ×¨××” ×©×”×–×™×›×¨×•×Ÿ ×©×œ×š ×™×¦× ×œ×—×•×¤×©×”... OTHER_PLAYER ××•×‘×™×œ/×”!' },
            { type: 'motivate', message: 'PLAYER, ×–×” ×”×–××Ÿ ×œ×—×–×•×¨ ×œ××©×—×§! OTHER_PLAYER, ×ª×™×–×”×¨/×™ - ×”×•×/×”×™× ×¢×•×“ ×™×—×–×•×¨/×ª×—×–×•×¨!' },
            { type: 'sweet', message: '××•×œ×™ PLAYER ×œ× ×–×•×›×¨/×ª ×”×›×œ, ××‘×œ OTHER_PLAYER ×‘×˜×•×— ×–×•×›×¨/×ª ×œ××” ×”×•×/×”×™× ×”×ª××”×‘/×”!' },
            { type: 'challenge', message: 'OTHER_PLAYER, × ×¨××” ×©×™×© ×œ×š ×–×™×›×¨×•×Ÿ ×©×œ ×¤×™×œ! PLAYER, ×ª×¨××”/×™ ×œ×•/×œ×” ××” ××ª/×” ×™×•×“×¢/×ª!' },
            { type: 'romantic', message: 'PLAYER, ××•×œ×™ ×”×–×™×›×¨×•×Ÿ ×‘×•×’×“ ×‘×š, ××‘×œ ×”××”×‘×” ×©×œ×›× ×—×–×§×” ××ª××™×“!' },
            { type: 'playful', message: 'PLAYER ×¦×¨×™×š/×” ×›× ×¨××” ×•×™×˜××™× ×™× ×œ×–×™×›×¨×•×Ÿ... OTHER_PLAYER, ××œ ×ª×¨×—×/×™!' },
            { type: 'supportive', message: '×–×” ×‘×¡×“×¨ PLAYER, ×œ× ×ª××™×“ ×–×•×›×¨×™× ×”×›×œ. OTHER_PLAYER, ×ª×Ÿ/×™ ×œ×•/×œ×” ×¦\'×× ×¡!' }
        ];

        function getGenderText(gender, maleText, femaleText) {
            return gender === 'male' ? maleText : femaleText;
        }

        function getGenderVerb(gender, maleVerb, femaleVerb) {
            return gender === 'male' ? maleVerb : femaleVerb;
        }

        function updateButtonTexts() {
            const player1Verb = getGenderVerb(gameState.player1.gender, '× ×™×¦×—', '× ×™×¦×—×”');
            const player2Verb = getGenderVerb(gameState.player2.gender, '× ×™×¦×—', '× ×™×¦×—×”');
            
            document.getElementById('player1-btn').textContent = `${gameState.player1.name} ${player1Verb}`;
            document.getElementById('player2-btn').textContent = `${gameState.player2.name} ${player2Verb}`;
        }

        function replacePlayerNames(text) {
            return text
                .replace(/PLAYER1/g, gameState.player1.name)
                .replace(/PLAYER2/g, gameState.player2.name);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function nextScreen() {
            const screens = ['welcome-screen', 'players-screen', 'prize-screen', 'rules-screen'];
            gameState.currentScreen++;
            
            if (gameState.currentScreen === 2) {
                savePlayersInfo();
                return;
            } else if (gameState.currentScreen === 3) {
                savePrizeInfo();
                return;
            }

            if (gameState.currentScreen < screens.length) {
                showScreen(screens[gameState.currentScreen]);
            }
        }

        function savePlayersInfo() {
            const player1Name = document.getElementById('player1-name').value.trim();
            const player2Name = document.getElementById('player2-name').value.trim();
            
            if (!player1Name || !player2Name) {
                alert('×× × ×”×›× ×¡ ××ª ×©××•×ª ×”×©×—×§× ×™×');
                gameState.currentScreen--;
                return;
            }

            gameState.player1.name = player1Name;
            gameState.player1.gender = document.getElementById('player1-gender').value;
            gameState.player2.name = player2Name;
            gameState.player2.gender = document.getElementById('player2-gender').value;

            document.getElementById('player1-display').textContent = player1Name;
            document.getElementById('player2-display').textContent = player2Name;
            updateButtonTexts();

            showScreen('prize-screen');
        }

        function savePrizeInfo() {
            gameState.prize = document.getElementById('prize').value.trim() || '×”× ×¦×—×•×Ÿ!';
            showScreen('rules-screen');
        }

        function startCountdown() {
            gameState.sensualTasks = document.getElementById('sensual-tasks').checked;
            showScreen('countdown-screen');
            let count = 3;
            const timer = document.getElementById('countdown-timer');
            
            const countdown = setInterval(() => {
                if (count > 0) {
                    timer.textContent = count;
                    count--;
                } else if (count === 0) {
                    timer.textContent = '×‘×”×¦×œ×—×”! ğŸ®';
                    count--;
                } else {
                    clearInterval(countdown);
                    startGame();
                }
            }, 1000);
        }

        function startGame() {
            gameState.currentQuestion = 0;
            gameState.currentChapter = 0;
            showChapter();
        }

        function showChapter() {
            if (gameState.currentChapter < chapters.length) {
                document.getElementById('chapter-title').textContent = chapters[gameState.currentChapter].title;
                showScreen('chapter-screen');
            } else {
                showResults();
            }
        }

        function startQuestions() {
            showScreen('game-screen');
            displayCurrentQuestion();
        }

        function displayCurrentQuestion() {
            const chapter = chapters[gameState.currentChapter];
            const questionIndex = gameState.currentQuestion - getTotalQuestionsBeforeChapter(gameState.currentChapter);
            
            if (questionIndex < chapter.questions.length) {
                let questionText = chapter.questions[questionIndex];
                questionText = replacePlayerNames(questionText);
                document.getElementById('question-display').textContent = questionText;
                
                document.getElementById('current-question').textContent = gameState.currentQuestion + 1;
                
                const progress = ((gameState.currentQuestion + 1) / getTotalQuestions()) * 100;
                document.getElementById('progress-fill').style.width = progress + '%';
                
                updateScoreDisplay();
            } else {
                gameState.currentChapter++;
                if (gameState.currentChapter < chapters.length) {
                    showChapter();
                } else {
                    showResults();
                }
            }
        }

        function getTotalQuestions() {
            return chapters.reduce((total, chapter) => total + chapter.questions.length, 0);
        }

        function getTotalQuestionsBeforeChapter(chapterIndex) {
            let total = 0;
            for (let i = 0; i < chapterIndex; i++) {
                total += chapters[i].questions.length;
            }
            return total;
        }

        function answerQuestion(answer) {
            if (!gameState.hasUsedUndo) {
                gameState.lastAction = {
                    question: gameState.currentQuestion,
                    chapter: gameState.currentChapter,
                    player1Score: gameState.player1.score,
                    player2Score: gameState.player2.score,
                    player1Failures: gameState.player1.failures,
                    player2Failures: gameState.player2.failures,
                    player1ConsecutiveFailures: gameState.player1.consecutiveFailures,
                    player2ConsecutiveFailures: gameState.player2.consecutiveFailures
                };
            }

            let willHaveFiveFailures = false;
            
            if (answer === 1) {
                gameState.player1.score++;
                gameState.player1.consecutiveFailures = 0;
                gameState.player2.failures++;
                gameState.player2.consecutiveFailures++;
                if (gameState.player2.failures === 5) willHaveFiveFailures = true;
            } else if (answer === 2) {
                gameState.player2.score++;
                gameState.player2.consecutiveFailures = 0;
                gameState.player1.failures++;
                gameState.player1.consecutiveFailures++;
                if (gameState.player1.failures === 5) willHaveFiveFailures = true;
            } else if (answer === 'both') {
                gameState.player1.score++;
                gameState.player2.score++;
                gameState.player1.consecutiveFailures = 0;
                gameState.player2.consecutiveFailures = 0;
            } else if (answer === 'none') {
                gameState.player1.failures++;
                gameState.player2.failures++;
                gameState.player1.consecutiveFailures++;
                gameState.player2.consecutiveFailures++;
                if (gameState.player1.failures === 5 || gameState.player2.failures === 5) willHaveFiveFailures = true;
            }

            if (!willHaveFiveFailures) {
                checkForEncouragementMessage();
            }
            checkForSensualTask();
            
            gameState.currentQuestion++;
            displayCurrentQuestion();
        }

        function checkForEncouragementMessage() {
            let messagePlayer = null;
            let otherPlayer = null;

            if (gameState.player1.consecutiveFailures === 3) {
                messagePlayer = gameState.player1;
                otherPlayer = gameState.player2;
                gameState.player1.consecutiveFailures = 0;
            } else if (gameState.player2.consecutiveFailures === 3) {
                messagePlayer = gameState.player2;
                otherPlayer = gameState.player1;
                gameState.player2.consecutiveFailures = 0;
            }

            if (messagePlayer) {
                const messageType = encouragementMessages[Math.floor(Math.random() * encouragementMessages.length)];
                let message = messageType.message
                    .replace(/PLAYER/g, messagePlayer.name)
                    .replace(/OTHER_PLAYER/g, otherPlayer.name);

                if (messagePlayer.gender === 'female') {
                    message = message
                        .replace(/××ª\/×”/g, '××ª')
                        .replace(/××ª×§×©×”/g, '××ª×§×©×”')
                        .replace(/×ª×ª×™×™××©\/×™/g, '×ª×ª×™×™××©×™')
                        .replace(/×—×•×–×¨\/×ª/g, '×—×•×–×¨×ª')
                        .replace(/×–×•×›×¨\/×ª/g, '×–×•×›×¨×ª')
                        .replace(/×™×•×“×¢\/×ª/g, '×™×•×“×¢×ª')
                        .replace(/×¦×¨×™×š\/×”/g, '×¦×¨×™×›×”')
                        .replace(/×ª×¨××”\/×™/g, '×ª×¨××™')
                        .replace(/×œ×•\/×œ×”/g, '×œ×”')
                        .replace(/×”×•×\/×”×™×/g, '×”×™×')
                        .replace(/×™×—×–×•×¨\/×ª×—×–×•×¨/g, '×ª×—×–×•×¨');
                }

                if (otherPlayer.gender === 'female') {
                    message = message
                        .replace(/×ª×ª×›×•× ×Ÿ\/×™/g, '×ª×ª×›×•× × ×™')
                        .replace(/××“×”×™×\/×”/g, '××“×”×™××”')
                        .replace(/××•×‘×™×œ\/×”/g, '××•×‘×™×œ×”')
                        .replace(/×ª×™×–×”×¨\/×™/g, '×ª×™×–×”×¨×™')
                        .replace(/×”×ª××”×‘\/×”/g, '×”×ª××”×‘×”')
                        .replace(/×ª×Ÿ\/×™/g, '×ª× ×™')
                        .replace(/×ª×¨×—×\/×™/g, '×ª×¨×—××™');
                }

                showMessage(message);
            }
        }

        function checkForSensualTask() {
            if (!gameState.sensualTasks) return;

            let taskPlayer = null;
            if (gameState.player1.failures >= 5) {
                taskPlayer = gameState.player1;
                gameState.currentTaskPlayer = gameState.player1;
                gameState.player1.failures = 0;
            } else if (gameState.player2.failures >= 5) {
                taskPlayer = gameState.player2;
                gameState.currentTaskPlayer = gameState.player2;
                gameState.player2.failures = 0;
            }

            if (taskPlayer) {
                if (gameState.currentTaskIndex >= sensualTasks.length) {
                    gameState.currentTaskIndex = 0;
                    showMessage(`× ×’××¨×• ×”××©×™××•×ª! ×—×•×–×¨×™× ×œ×”×ª×—×œ×”... ğŸ˜`);
                    setTimeout(() => {
                        showFailureWarning(taskPlayer);
                    }, 2000);
                } else {
                    showFailureWarning(taskPlayer);
                }
            }
        }

        function showFailureWarning(player) {
            const genderReady = getGenderText(player.gender, '××•×›×Ÿ', '××•×›× ×”');
            const genderText = getGenderText(player.gender, '×”×’×¢×ª', '×”×’×¢×ª');
            
            document.getElementById('failure-warning-content').innerHTML = `
                <strong>${player.name}, ${genderText} ×œ-5 ×¤×¡×™×œ×•×ª!</strong><br><br>
                ×œ×›×Ÿ ×ª×§×‘×œ×• ××©×™××” ××™× ×™×ª ×‘××™×•×—×“...<br><br>
                ${genderReady} ×œ××©×™××” ×©×œ×š? ğŸ˜
            `;
            
            document.getElementById('failure-warning-popup').style.display = 'flex';
        }

        function showSensualTask() {
            document.getElementById('failure-warning-popup').style.display = 'none';
            
            let task = sensualTasks[gameState.currentTaskIndex];
            const currentPlayer = gameState.currentTaskPlayer;
            const otherPlayer = currentPlayer === gameState.player1 ? gameState.player2 : gameState.player1;
            
            task = task.replace(/PLAYER1/g, currentPlayer.name).replace(/PLAYER2/g, otherPlayer.name);
            
            if (currentPlayer.gender === 'female') {
                task = task.replace(/×©×‘\/×™/g, '×©×‘×™')
                          .replace(/×ª×Ÿ\/×™/g, '×ª× ×™')
                          .replace(/×”×•×¨×“\/×™/g, '×”×•×¨×™×“×™')
                          .replace(/×œ×—×©\/×™/g, '×œ×—×©×™')
                          .replace(/×œ×§×§\/×™/g, '×œ×§×§×™')
                          .replace(/× ×©×§\/×™/g, '× ×©×§×™')
                          .replace(/×ª××¨\/×™/g, '×ª××¨×™')
                          .replace(/×”×¢×‘×¨\/×™/g, '×”×¢×‘×™×¨×™');
            }
            
            if (otherPlayer.gender === 'female') {
                task = task.replace(/×‘×—×™×¨×ª×•\/×”/g, '×‘×—×™×¨×ª×”');
            }
            
            document.getElementById('task-content').innerHTML = `
                <div style="padding: 1rem; background: rgba(255,255,255,0.2); border-radius: 15px; font-size: 1.4rem; line-height: 1.6;">
                    ${task}
                </div>
            `;
            
            document.getElementById('task-popup').style.display = 'flex';
            gameState.currentTaskIndex++;
        }

        function skipTask() {
            document.getElementById('failure-warning-popup').style.display = 'none';
        }

        function completeTask() {
            document.getElementById('task-popup').style.display = 'none';
        }

        function showMessage(message) {
            document.getElementById('message-content').innerHTML = `
                <div style="font-size: 1.4rem; padding: 1.5rem; line-height: 1.6;">
                    ${message}
                </div>
            `;
            document.getElementById('message-popup').style.display = 'flex';
        }

        function closeMessagePopup() {
            document.getElementById('message-popup').style.display = 'none';
        }

        function undoLastAction() {
            if (!gameState.lastAction) {
                showMessage('××™×Ÿ ×¤×¢×•×œ×” ×œ×‘×™×˜×•×œ');
                return;
            }

            if (gameState.hasUsedUndo) {
                showMessage('× ×™×ª×Ÿ ×œ×‘×˜×œ ×¨×§ ×¤×¢× ××—×ª');
                return;
            }

            gameState.currentQuestion = gameState.lastAction.question;
            gameState.currentChapter = gameState.lastAction.chapter;
            gameState.player1.score = gameState.lastAction.player1Score;
            gameState.player2.score = gameState.lastAction.player2Score;
            gameState.player1.failures = gameState.lastAction.player1Failures;
            gameState.player2.failures = gameState.lastAction.player2Failures;
            gameState.player1.consecutiveFailures = gameState.lastAction.player1ConsecutiveFailures;
            gameState.player2.consecutiveFailures = gameState.lastAction.player2ConsecutiveFailures;
            
            gameState.hasUsedUndo = true;
            displayCurrentQuestion();
            showMessage('×”×¤×¢×•×œ×” ×‘×•×˜×œ×”');
        }

        function updateScoreDisplay() {
            document.getElementById('player1-failures').textContent = gameState.player1.failures;
            document.getElementById('player2-failures').textContent = gameState.player2.failures;
        }

        function createConfetti() {
            const colors = ['#ff0084', '#00ffff', '#ffeaa7', '#fab1a0', '#74b9ff'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 50);
            }
        }

        function showResults() {
            const player1Score = gameState.player1.score;
            const player2Score = gameState.player2.score;
            let winner, winnerGender;
            
            if (player1Score > player2Score) {
                winner = gameState.player1.name;
                winnerGender = gameState.player1.gender;
                createConfetti();
            } else if (player2Score > player1Score) {
                winner = gameState.player2.name;
                winnerGender = gameState.player2.gender;
                createConfetti();
            } else {
                winner = null;
            }

            let resultsHTML = `
                <div style="text-align: center;">
                    <h2 style="font-size: 2rem; margin-bottom: 3rem;">ğŸ“Š ×ª×•×¦××•×ª ×¡×•×¤×™×•×ª</h2>
                    <div style="display: flex; justify-content: space-around; margin: 3rem 0; flex-wrap: wrap;">
                        <div style="margin: 2rem; min-width: 200px;">
                            <h3 style="font-size: 1.8rem; margin-bottom: 1rem;">${gameState.player1.name}</h3>
                            <div class="score-animation" style="font-size: 3rem;">${player1Score}</div>
                            <div style="font-size: 1.2rem; margin-top: 0.5rem;">× ×§×•×“×•×ª</div>
                        </div>
                        <div style="margin: 2rem; min-width: 200px;">
                            <h3 style="font-size: 1.8rem; margin-bottom: 1rem;">${gameState.player2.name}</h3>
                            <div class="score-animation" style="font-size: 3rem;">${player2Score}</div>
                            <div style="font-size: 1.2rem; margin-top: 0.5rem;">× ×§×•×“×•×ª</div>
                        </div>
                    </div>
            `;

            if (winner) {
                const winnerVerb = getGenderText(winnerGender, '× ×™×¦×—', '× ×™×¦×—×”');
                resultsHTML += `
                    <div style="background: linear-gradient(45deg, #ffeaa7, #fab1a0); color: #333; padding: 3rem; border-radius: 25px; margin: 3rem 0; animation: pulse 2s infinite;">
                        <h3 style="font-size: 2rem; margin-bottom: 1rem;">ğŸ† ${winner} ${winnerVerb}!</h3>
                        <p style="font-size: 1.4rem; margin-top: 1.5rem;">
                            ×”×¤×¨×¡ ×©×œ×š: <strong>${gameState.prize}</strong>
                        </p>
                    </div>
                `;
            } else {
                resultsHTML += `
                    <div style="background: linear-gradient(45deg, #74b9ff, #0984e3); padding: 3rem; border-radius: 25px; margin: 3rem 0; animation: pulse 2s infinite;">
                        <h3 style="font-size: 2rem; margin-bottom: 1rem;">ğŸ¤ ×ª×™×§×•!</h3>
                        <p style="font-size: 1.4rem; margin-top: 1.5rem;">
                            ×©× ×™×›× ×–×•×›×™× ×‘: <strong>${gameState.prize}</strong>
                        </p>
                    </div>
                `;
            }

            resultsHTML += `
                    <div style="margin-top: 3rem; font-size: 1.2rem; line-height: 1.8;">
                        <p>ğŸ’• ×ª×•×“×” ×©×™×—×§×ª× ×‘××©×—×§ ×”×–×™×›×¨×•×Ÿ ×”×’×“×•×œ!</p>
                        <p>××™×–×” ×›×™×£ ×œ×¨××•×ª ×›××” ××ª× ××›×™×¨×™× ××—×“ ××ª ×”×©× ×™!</p>
                    </div>
                </div>
            `;

            document.getElementById('final-results').innerHTML = resultsHTML;
            showScreen('results-screen');
        }

        function shareResults() {
            const player1Score = gameState.player1.score;
            const player2Score = gameState.player2.score;
            let winner = '';
            
            if (player1Score > player2Score) {
                const winnerVerb = getGenderText(gameState.player1.gender, '× ×™×¦×—', '× ×™×¦×—×”');
                winner = `ğŸ† ${gameState.player1.name} ${winnerVerb}!`;
            } else if (player2Score > player1Score) {
                const winnerVerb = getGenderText(gameState.player2.gender, '× ×™×¦×—', '× ×™×¦×—×”');
                winner = `ğŸ† ${gameState.player2.name} ${winnerVerb}!`;
            } else {
                winner = 'ğŸ¤ ×ª×™×§×•!';
            }

            const message = `ğŸ® ×¡×™×™×× ×• ××ª ××©×—×§ ×”×–×™×›×¨×•×Ÿ ×”×’×“×•×œ!\n\n` +
                          `${gameState.player1.name}: ${player1Score} × ×§×•×“×•×ª\n` +
                          `${gameState.player2.name}: ${player2Score} × ×§×•×“×•×ª\n\n` +
                          `${winner}\n\n` +
                          `×”×¤×¨×¡: ${gameState.prize}\n\n` +
                          `ğŸ’• ×”×™×” ×›×™×£ ×œ×¨××•×ª ×›××” ×× ×—× ×• ××›×™×¨×™× ××—×“ ××ª ×”×©× ×™!`;

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        function restartGame() {
            gameState = {
                currentScreen: 0,
                currentQuestion: 0,
                currentChapter: 0,
                player1: { name: '', gender: 'male', score: 0, failures: 0, consecutiveFailures: 0 },
                player2: { name: '', gender: 'male', score: 0, failures: 0, consecutiveFailures: 0 },
                prize: '',
                sensualTasks: true,
                currentTaskIndex: 0,
                lastAction: null,
                currentTaskPlayer: null,
                hasUsedUndo: false
            };

            document.getElementById('player1-name').value = '';
            document.getElementById('player2-name').value = '';
            document.getElementById('prize').value = '';
            document.getElementById('sensual-tasks').checked = true;

            showScreen('welcome-screen');
        }

        function openSettings() {
            document.getElementById('settings-player1-name').value = gameState.player1.name;
            document.getElementById('settings-player2-name').value = gameState.player2.name;
            document.getElementById('settings-prize').value = gameState.prize;
            document.getElementById('settings-popup').style.display = 'flex';
        }

        function saveSettings() {
            gameState.player1.name = document.getElementById('settings-player1-name').value.trim() || gameState.player1.name;
            gameState.player2.name = document.getElementById('settings-player2-name').value.trim() || gameState.player2.name;
            gameState.prize = document.getElementById('settings-prize').value.trim() || gameState.prize;
            
            document.getElementById('player1-display').textContent = gameState.player1.name;
            document.getElementById('player2-display').textContent = gameState.player2.name;
            updateButtonTexts();
            
            closeSettings();
            showMessage('×”×”×’×“×¨×•×ª × ×©××¨×• ×‘×”×¦×œ×—×”!');
        }

        function closeSettings() {
            document.getElementById('settings-popup').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const sensualToggle = document.getElementById('sensual-tasks');
            const warning = document.getElementById('sensual-warning');
            
            function updateSensualWarning() {
                if (sensualToggle.checked) {
                    warning.style.display = 'block';
                    warning.innerHTML = 'âš ï¸ ×‘×—×™×¨×” ×‘"×›×Ÿ" ×ª×•×¡×™×£ ××©×™××•×ª ××™× ×˜×™××™×•×ª ×œ××©×—×§';
                    warning.className = 'sensual-warning';
                } else {
                    warning.style.display = 'block';
                    warning.innerHTML = 'âœ… ×œ× ×™×”×™×• ××©×™××•×ª ××™× ×˜×™××™×•×ª ×‘××©×—×§';
                    warning.style.background = 'linear-gradient(45deg, #4ecdc4, #44a08d)';
                    warning.style.animation = 'none';
                }
            }
            
            sensualToggle.addEventListener('change', updateSensualWarning);
            updateSensualWarning();
        });
    </script>
</body>
</html>